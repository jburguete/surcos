/*
SURCOS - A software tool to solve irrigation and fertigation in isolated furrows
and furrow networks.

Copyright 2011-2023, Javier Burguete Tolosa.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
  list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright notice,
  this list of conditions and the following disclaimer in the documentation
  and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY Javier Burguete Tolosa ``AS IS'' AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL Javier Burguete Tolosa OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

/**
 * \file configIrrigation.c
 * \brief Source file to define the configuration of the irrigation.
 * \authors Javier Burguete Tolosa, Asier Lacasta Soto.
 * \copyright Copyright 2011-2023, Javier Burguete Tolosa.
 */
#include "config.h"
#include "jb/src/jb_win.h"
#include "jb/src/jb_json.h"
#include "furrow.h"
#include "parameters.h"
#include "field.h"
#include "configIrrigation.h"

#define DEBUG_INPUT_UPDATE 0
///< Macro to debug the config_irrigation_new() function

#define DEBUG_CONFIG_IRRIGATION_READ 0
///< Macro to debug the config_irrigation_read() function

#define DEBUG_CONFIG_IRRIGATION_NEW 0
///< Macro to debug the config_irrigation_new() function

///> Input diagram pixmap.
const char *diagram_input[] = {
/* columns rows colors chars-per-pixel */
  "283 160 2 1 ",
  "  c black",
  ". c white",
/* pixels */
  "...........................................................................................................................................................................................................................................................................................",
  "...........................................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  "....................  .....................................................................................................................................................................................................................................................................",
  "...................   .....................................................................................................................................................................................................................................................................",
  "...................   .....................................................................................................................................................................................................................................................................",
  "...................    ....................................................................................................................................................................................................................................................................",
  "..................   . ....................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  ".................... ......................................................................................................................................................................................................................................................................",
  "...........   ...... ......................................................................................................................................................................................................................................................................",
  ".......... .. ...... ......................................................................................................................................................................................................................................................................",
  "......... ... ...... ......................................................................................................................................................................................................................................................................",
  "......... .. ....... ......................................................................................................................................................................................................................................................................",
  "......... .. ....... .... ... .... ... ... .... ... .... ... .... ... ... .... ... .... .                                                                                                    ..............................................................................................",
  "..........   ....... .................................................................... .................................................................................................. ..............................................................................................",
  "............ ....... .................................................................... .................................................................................................. ..............................................................................................",
  "............ ....... .................................................................... .................................................................................................. ..............................................................................................",
  "..........   ....... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ..............................................................................................",
  ".................... .................................................................... .................................................................................................. ................................................................................. ............",
  ".................... .................................................................... .................................................................................................. ..................................................................................   .........",
  "....................                                                                                                                                                                                                                                                                 ......",
  "................................................................................................................................................................................................................................................................................    .......",
  "..............................................................................................................................................................................................................................................................................   ..........",
  "...........................................................................................................................................................................................................................................................................................",
  "..........  ................... ......................................................................................................................................................... .................................................................................................",
  ".......... ...   ........   .... ...................................................... ................................................................................................ ..................................................................................................",
  "......... ... ... ...... ... ... ..................................................... ................................................................................................. ..................................................................................................",
  "........ .... ... ...... ... .... .................................................... ...............................................................................................     ................................................................................................",
  "........ .... ... ...... ... .... ..................................................     ............................................................................................... ......  ..........................................................................................",
  "........ .... ... ...... ... .... .................................................... ................................................................................................. ......  ..........................................................................................",
  "........ .... ... ...... ... .... .................................................... ...   .......................................................................................... ...... ............................................................................................",
  "........ .... ... ...... ... .... ................................................... ... ... ......................................................................................... . ....  ...........................................................................................",
  "........ ....  .  ......  .  .... ................................................... . . ... .........................................................................................  ..... ............................................................................................",
  "........ .....   ... ....   ..... ...................................................  .. ... ................................................................................................ ............................................................................................",
  "......... .......... ........... ........................................................ ... ................................................................................................ ............................................................................................",
  "......... .......... ........... .........................................................   ................................................................................................ .............................................................................................",
  ".......... ......... .......... ............................................................................................................................................................  .............................................................................................",
  "...........................................................................................................................................................................................................................................................................................",
  "...........................................................................................................................................................................................................................................................................................",
  "...........................................................................................................................................................................................................................................................................................",
  "..........................................................................................................................................................................................................................................................................................."
};

/**
 * Function to insert inputs.
 */
static void
input_insert (GList ** list,    ///< List of inputs.
              unsigned int nInputsOld,  ///< Old inputs number.
              unsigned int nInputs,     ///< New inputs number.
              GtkGrid * grid)   ///< configuration GtkGrid.
{
  double min[5] = { -1e6, -1e6, 0., 0., 0. };
  double max[5] = { 1e6, 1e6, 1e6, 1e6, 1. };
  double step[5] = { 0.01, 0.01, 1., 1., 1e-6 };
  char buffer[32];
  GtkWidget *widget;
  unsigned int i, j;
  for (i = nInputsOld; i < nInputs; ++i)
    {
      snprintf (buffer, 32, "%d", i + 1);
      widget = gtk_button_new_with_label (buffer);
      gtk_widget_set_can_focus (widget, FALSE);
      gtk_widget_show (widget);
      gtk_grid_attach (grid, widget, 0, i + 1, 1, 1);
      *list = g_list_append (*list, widget);
      for (j = 0; j < 5; ++j)
        {
          widget = gtk_spin_button_new_with_range (min[j], max[j], step[j]);
          gtk_widget_show (widget);
          gtk_grid_attach (grid, widget, j + 1, i + 1, 1, 1);
          *list = g_list_append (*list, widget);
        }
    }
}

/**
 * Function to remove inputs.
 */
static void
input_remove (GList ** list,    ///< List of inputs.
              unsigned int nInputsOld,  ///< Old inputs number.
              unsigned int nInputs,     ///< New inputs number.
              GtkGrid * grid __attribute__((unused)))
  ///< configuration GtkGrid.
{
  GList *element, *next;
  unsigned int i, j;
  element = g_list_nth (*list, 6 * nInputs);
  for (i = nInputs; i < nInputsOld; ++i)
    {
      for (j = 0; j < 6; ++j)
        {
          next = element->next;
          gtk_grid_remove (grid, GTK_WIDGET (element->data));
          *list = g_list_remove_link (*list, element);
          element = next;
        }
    }
  if (!nInputs)
    *list = NULL;
}

/**
 * Function to update the inputs number.
 */
static void
input_update (GList ** list,    ///< List of inputs.
              unsigned int *nInputs,    ///< New inputs number.
              GtkSpinButton * spin,
              ///< GtkSpinButton defining the inputs number.
              GtkGrid * grid)   ///< configuration GtkGrid.
{
  unsigned int nInputsOld;
  nInputsOld = *nInputs;
#if DEBUG_INPUT_UPDATE
  printf ("input_update: start\n");
#endif
  *nInputs = gtk_spin_button_get_value_as_int (spin);
#if DEBUG_INPUT_UPDATE
  printf ("nInputs = %d\n", *nInputs);
  printf ("Inserting rows\n");
#endif
  input_insert (list, nInputsOld, *nInputs, grid);
#if DEBUG_INPUT_UPDATE
  printf ("Removing extra rows\n");
#endif
  input_remove (list, nInputsOld, *nInputs, grid);
#if DEBUG_INPUT_UPDATE
  printf ("input_update: end\n");
#endif
}

/**
 * Function to read the irrigation configuration.
 */
void
config_irrigation_read (ConfigIrrigation * w)
///< Structure of irrigation configuration.
{
  Input *input;
  GList *list;
  unsigned int i, j;
#if DEBUG_CONFIG_IRRIGATION_READ
  printf ("config_irrigation_read: start\n");
#endif
  for (j = 0; j < 2; ++j)
    {
#if DEBUG_CONFIG_IRRIGATION_READ
      printf ("j=%u n=%u\n", j, w->n[j]);
#endif
      gtk_spin_button_set_value (w->spin[j], w->n[j]);
#if DEBUG_CONFIG_IRRIGATION_READ
      printf ("inserting row\n");
#endif
      input_insert (&w->list[j], 0, w->n[j], w->grid[j]);
      list = w->list[j];
      input = w->input[j];
      for (i = 0; i < w->n[j]; ++i)
        {
#if DEBUG_CONFIG_IRRIGATION_READ
          printf ("x=" FGL " y=" FGL "\n", input[i].x, input[i].x);
#endif
          list = list->next;
          gtk_spin_button_set_value (GTK_SPIN_BUTTON (list->data), input[i].x);
          list = list->next;
          gtk_spin_button_set_value (GTK_SPIN_BUTTON (list->data), input[i].y);
          list = list->next;
          gtk_spin_button_set_value (GTK_SPIN_BUTTON (list->data), input[i].t0);
          list = list->next;
          gtk_spin_button_set_value (GTK_SPIN_BUTTON (list->data), input[i].tf);
          list = list->next;
          gtk_spin_button_set_value (GTK_SPIN_BUTTON (list->data), input[i].q);
          list = list->next;
        }
    }
#if DEBUG_CONFIG_IRRIGATION_READ
  printf ("config_irrigation_read: end\n");
#endif
}

/**
 * Function to write the irrigation configuration.
 */
void
config_irrigation_write (ConfigIrrigation * w)
///< Structure of irrigation configuration.
{
  unsigned int n[2];
  Input *input;
  GList *list;
  unsigned int i, j;
  for (j = 0; j < 2; ++j)
    {
      n[j] = gtk_spin_button_get_value_as_int (w->spin[j]);
      if (n[j])
        w->input[j] = (Input *) realloc (w->input[j], n[j] * sizeof (Input));
      else
        {
          free (w->input[j]);
          w->input[j] = NULL;
          continue;
        }
      input = w->input[j];
      list = w->list[j];
      for (i = 0; i < n[j]; ++i)
        {
          list = list->next;
          input[i].x = gtk_spin_button_get_value (GTK_SPIN_BUTTON (list->data));
          list = list->next;
          input[i].y = gtk_spin_button_get_value (GTK_SPIN_BUTTON (list->data));
          list = list->next;
          input[i].t0
            = gtk_spin_button_get_value (GTK_SPIN_BUTTON (list->data));
          list = list->next;
          input[i].tf
            = gtk_spin_button_get_value (GTK_SPIN_BUTTON (list->data));
          list = list->next;
          input[i].q = gtk_spin_button_get_value (GTK_SPIN_BUTTON (list->data));
          list = list->next;
        }
    }
}

/**
 * Function to update the irrigation configuration water inputs.
 */
static void
config_irrigation_water (ConfigIrrigation * w)
///< Structure of irrigation configuration.
{
  input_update (&w->list[0], &w->n[0], w->spin[0], w->grid[0]);
}

/**
 * Function to update the irrigation configuration fertilizer inputs.
 */
static void
config_irrigation_fertilizer (ConfigIrrigation * w)
///< Structure of irrigation configuration.
{
  input_update (&w->list[1], &w->n[1], w->spin[1], w->grid[1]);
}

/**
 * Function to free the memory used by the irrigation configuration grid.
 */
static void
config_irrigation_destroy (ConfigIrrigation * w)
///< Structure of irrigation configuration.
{
  g_list_free (w->list[0]);
  g_list_free (w->list[1]);
}

/**
 * Function to open the irrigation configuration grid.
 */
void
config_irrigation_new (ConfigIrrigation * w)
///< Structure of irrigation configuration.
{
  char buffer[512];
  const char *label1[] = {
    _("Input"),
    "x (m)",
    "y (m)",
    _("Initial time (s)"),
    _("Final time (s)"),
    _("Discharge (m/s)")
  };
  const char *label2[] = {
    _("Input"),
    "x (m)",
    "y (m)",
    _("Initial time (s)"),
    _("Final time (s)"),
    _("Discharge (kg/s)")
  };
  const char *label_number[2] = {
    _("Number of water inputs"),
    _("Number of fertilizer inputs")
  };
  const char *label_frame[2] = { _("Water"), _("Fertilizer") };
  const char **label_input[2] = { label1, label2 };
  double min[2] = { 1., 0. };
  double max[2] = { 10., 10. };
  double step[2] = { 1., 1. };
  unsigned int i, j;

#if DEBUG_CONFIG_IRRIGATION_NEW
  printf ("config_irrigation_new: start\n");
  printf ("creating the boxes\n");
#endif
  w->box = (GtkGrid *) gtk_grid_new ();

  w->box_picture = (GtkGrid *) gtk_grid_new ();
  gtk_grid_attach (w->box, GTK_WIDGET (w->box_picture), 0, 0, 1, 1);
  w->picture = (GtkPicture *)
    gtk_picture_new_for_pixbuf (gdk_pixbuf_new_from_xpm_data (diagram_input));
  gtk_grid_attach (w->box_picture, GTK_WIDGET (w->picture), 0, 0, 1, 1);
  snprintf (buffer, 512, "q: %s\nt0: %s\ntf: %s", _("Discharge"),
            _("Initial time"), _("Final time"));
  w->label_picture = (GtkLabel *) gtk_label_new (buffer);
  gtk_grid_attach (w->box_picture, GTK_WIDGET (w->label_picture), 0, 1, 1, 1);

  w->box_input = (GtkGrid *) gtk_grid_new ();
  gtk_grid_attach (w->box, GTK_WIDGET (w->box_input), 1, 0, 1, 1);
  w->box_number = (GtkGrid *) gtk_grid_new ();
  gtk_grid_attach (w->box_input, GTK_WIDGET (w->box_number), 0, 0, 1, 1);

#if DEBUG_CONFIG_IRRIGATION_NEW
  printf ("adding frames\n");
#endif
  for (i = 0; i < 2; ++i)
    {
      w->label[i] = (GtkLabel *) gtk_label_new (label_number[i]);
      gtk_grid_attach (w->box_number, GTK_WIDGET (w->label[i]), 2 * i, 0, 1, 1);
      w->spin[i] =
        (GtkSpinButton *) gtk_spin_button_new_with_range (min[i], max[i],
                                                          step[i]);
      gtk_grid_attach (w->box_number, GTK_WIDGET (w->spin[i]), 2 * i + 1, 0,
                       1, 1);
      w->frame[i] = (GtkFrame *) gtk_frame_new (label_frame[i]);
      gtk_grid_attach (w->box_input, GTK_WIDGET (w->frame[i]), 0, i + 1, 5, 1);
      w->grid[i] = (GtkGrid *) gtk_grid_new ();
      gtk_frame_set_child (w->frame[i], GTK_WIDGET (w->grid[i]));
      for (j = 0; j < 6; ++j)
        {
          w->button[j][i] = (GtkButton *) gtk_button_new_with_label
            (label_input[i][j]);
          gtk_widget_set_can_focus (GTK_WIDGET (w->button[j][i]), FALSE);
          gtk_grid_attach (w->grid[i], GTK_WIDGET (w->button[j][i]),
                           j, 0, 1, 1);
        }
      w->list[i] = NULL;
    }

#if DEBUG_CONFIG_IRRIGATION_NEW
  printf ("setting values\n");
#endif
  w->input[0] = w->input[1] = NULL;
  g_signal_connect_swapped (w->spin[0], "value-changed",
                            (GCallback) config_irrigation_water, w);
  g_signal_connect_swapped (w->spin[1], "value-changed",
                            (GCallback) config_irrigation_fertilizer, w);
  g_signal_connect_swapped (w->frame[0], "destroy",
                            (GCallback) config_irrigation_destroy, w);

#if DEBUG_CONFIG_IRRIGATION_NEW
  printf ("config_irrigation_new: end\n");
#endif
}
