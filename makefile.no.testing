basedir = /usr/
incdir = -I$(basedir)include/
incldir = -I$(basedir)lib/
incldir2 = $(incldir)x86_64-linux-gnu/
libdir = -L$(basedir)lib/
srcdir = src/
objdir = $(srcdir)
bindir = ./
podir = locale/
localdir = $(podir)
mandir = manual/
es = es/LC_MESSAGES/
fr = fr/LC_MESSAGES/

obj = $(objdir)jb_def.o $(objdir)jb_math.o $(objdir)jb_win.o \
	$(objdir)furrow.o $(objdir)parameters.o $(objdir)scheme.o $(objdir)field.o \
	$(objdir)kernel.o

src = $(srcdir)jb/jb_def.c $(srcdir)jb/jb_math.c $(srcdir)jb/jb_win.c \
	$(srcdir)furrow.c $(srcdir)parameters.c $(srcdir)scheme.c $(srcdir)field.c \
	$(srcdir)kernel.c 

man = $(mandir)ppal.tex $(mandir)bib/references.bib \
	$(mandir)capitulos/Capitulo1.tex \
	$(mandir)capitulos/Capitulo2.tex \
	$(mandir)capitulos/Capitulo3.tex \
	$(mandir)capitulos/Capitulo3.tex

dep = makefile.no.testing $(srcdir)jb/jb_config.h
depjb = $(dep) $(srcdir)jb/jb_def.h $(srcdir)jb/jb_math.h $(srcdir)jb/jb_win.h
depkernel = $(depjb) $(srcdir)config.h \
	$(srcdir)furrow.h $(srcdir)parameters.h $(srcdir)scheme.h $(srcdir)field.h \
	$(srcdir)kernel.h

inc = $(incdir)glib-2.0 $(incldir2)glib-2.0/include

lib = -lm -lgobject-2.0 -lgthread-2.0 -lglib-2.0

flags = $(inc) -c -O3

CC = gcc -Wall -DJBW=1 #-pg

exe = $(bindir)surcos

all: $(exe) doc/latex/refman.pdf $(mandir)ppal.pdf \
	$(podir)surcos.pot $(localdir)$(es)surcos.mo $(localdir)$(fr)surcos.mo 

## Our main object (NO GUI)
$(exe): $(obj) $(objdir)surcos.o
	$(CC) $(libdir) $(obj) $(objdir)surcos.o $(lib) -o $(exe)

## Objects!
$(objdir)jb_def.o: $(dep) $(srcdir)jb/jb_def.h $(srcdir)jb/jb_def.c
	$(CC) $(flags) $(srcdir)jb/jb_def.c -o $(objdir)jb_def.o

$(objdir)jb_math.o: $(dep) $(srcdir)jb/jb_def.h $(srcdir)jb/jb_math.h \
	$(srcdir)jb/jb_math.c
	$(CC) $(flags) $(srcdir)jb/jb_math.c -o $(objdir)jb_math.o

$(objdir)jb_win.o: $(depjb) $(srcdir)jb/jb_win.c
	$(CC) $(flags) $(srcdir)jb/jb_win.c -o $(objdir)jb_win.o

$(objdir)furrow.o: $(depjb) $(srcdir)config.h \
	$(srcdir)furrow.h $(srcdir)furrow.c
	$(CC) $(flags) $(srcdir)furrow.c -o $(objdir)furrow.o

$(objdir)parameters.o: $(depjb) $(srcdir)config.h $(srcdir)furrow.h \
	$(srcdir)parameters.h $(srcdir)parameters.c
	$(CC) $(flags) $(srcdir)parameters.c -o $(objdir)parameters.o

$(objdir)scheme.o: $(depjb) $(srcdir)config.h \
	$(srcdir)furrow.h $(srcdir)parameters.h $(srcdir)scheme.h $(srcdir)scheme.c
	$(CC) $(flags) $(srcdir)scheme.c -o $(objdir)scheme.o

$(objdir)field.o: $(depjb) $(srcdir)config.h \
	$(srcdir)furrow.h $(srcdir)parameters.h $(srcdir)scheme.h $(srcdir)field.h \
	$(srcdir)field.c
	$(CC) $(flags) $(srcdir)field.c -o $(objdir)field.o

$(objdir)kernel.o: $(depkernel) $(srcdir)kernel.c
	$(CC) $(flags) $(srcdir)kernel.c -o $(objdir)kernel.o

$(objdir)surcos.o: $(depkernel) $(srcdir)surcos.c
	$(CC) $(flags) $(srcdir)surcos.c -o $(objdir)surcos.o

## Making the languages general rules (NO GUI)
$(podir)surcos.pot: makefile $(src) $(srcdir)surcos.c
	xgettext -d $(exe) -o $(podir)surcos.pot --from-code=UTF-8 \
		$(src) $(srcdir)surcos.c 
## THE FIRST TIME
#	msginit -l es -o $(podir)$(es)surcos.po -i $(podir)surcos.pot \
		--no-translator
#	msginit -l fr -o $(podir)$(fr)surcos.po -i $(podir)surcos.pot \
		--no-translator
## OTHER TIMES
	msgmerge -U $(podir)$(es)surcos.po $(podir)surcos.pot
	msgmerge -U $(podir)$(fr)surcos.po $(podir)surcos.pot
	gedit --encoding UTF-8 $(podir)$(es)surcos.po $(podir)$(fr)surcos.po

## Compiling the spanish language
$(localdir)$(es)surcos.mo: $(podir)$(es)surcos.po $(podir)surcos.pot
	msgfmt -c -v -o $(localdir)$(es)surcos.mo $(podir)$(es)surcos.po

## Compiling the french language
$(localdir)$(fr)surcos.mo: $(podir)$(fr)surcos.po $(podir)surcos.pot
	msgfmt -c -v -o $(localdir)$(fr)surcos.mo $(podir)$(fr)surcos.po

## Making the reference manual
doc/latex/refman.pdf: Doxyfile makefile $(depkernel) $(src) $(srcdir)surcos.c
	doxygen
	cd doc/latex; make

## Compiling the user manual
$(mandir)ppal.pdf: makefile $(man)
	cd $(mandir); pdflatex ppal; bibtex ppal; pdflatex ppal; pdflatex ppal

## Clean all generated-objects
clean:
	rm $(exe) $(objdir)*.o $(mandir)ppal.pdf \
		$(localdir)$(es)surcos.mo $(localdir)$(fr)surcos.mo

## Rebuild option with cleaning functionallity
rebuild: clean $(exe)
