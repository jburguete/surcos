.PHONY: strip

basedir = @basedir@
sysdir = @sysdir@
bindir = @bindir@
sharedir = @sharedir@
icondir = $(sharedir)icons/
dlldir = $(sysdir)bin/
modir = $(sysdir)share/locale/
srcdir = src/
objdir = @objdir@
localdir = $(sharedir)locale/
podir = locale/
mandir = manual/
es = es/LC_MESSAGES/
fr = fr/LC_MESSAGES/
it = it/LC_MESSAGES/

config_h = $(srcdir)config.h
furrow_h = $(srcdir)furrow.h
paramaters_h = $(srcdir)parameters.h
scheme_h = $(srcdir)scheme.h
field_h = $(srcdir)field.h
kernel_h = $(srcdir)kernel.h
configIrrigation_h = $(srcdir)configIrrigation.h
configGeometry_h = $(srcdir)configGeometry.h
configFurrows_h = $(srcdir)configFurrows.h
configTimes_h = $(srcdir)configTimes.h
configProbes_h = $(srcdir)configProbes.h
configWindow_h = $(srcdir)configWindow.h
graphics_h = $(srcdir)graphics.h
mainWindow_h = $(srcdir)mainWindow.h
surcos_h = $(srcdir)surcos.h

furrow_c = $(srcdir)furrow.c
paramaters_c = $(srcdir)parameters.c
scheme_c = $(srcdir)scheme.c
field_c = $(srcdir)field.c
kernel_c = $(srcdir)kernel.c
configIrrigation_c = $(srcdir)configIrrigation.c
configGeometry_c = $(srcdir)configGeometry.c
configFurrows_c = $(srcdir)configFurrows.c
configTimes_c = $(srcdir)configTimes.c
configProbes_c = $(srcdir)configProbes.c
configWindow_c = $(srcdir)configWindow.c
graphics_c = $(srcdir)graphics.c
mainWindow_c = $(srcdir)mainWindow.c
surcos_gui_c = $(srcdir)surcos_gui.c
surcos_c = $(srcdir)surcos.c
main_c = $(srcdir)main.c

src = $(furrow_c) $(parameters_c) $(scheme_c) $(field_c) $(kernel_c) \
	$(configIrrigation_c) $(configGeometry_c) $(configFurrows_c) \
	$(configTimes_c) $(configProbes_c) $(configWindow_c) $(graphics_c) \
	$(mainWindow_c) $(surcos_gui_c)
srcbin = $(furrow_c) $(parameters_c) $(scheme_c) $(field_c) $(kernel_c) \
	$(surcos_c)

furrow_pgo = $(objdir)furrow.pgo
paramaters_pgo = $(objdir)parameters.pgo
scheme_pgo = $(objdir)scheme.pgo
field_pgo = $(objdir)field.pgo
kernel_pgo = $(objdir)kernel.pgo
configIrrigation_pgo = $(objdir)configIrrigation.pgo
configGeometry_pgo = $(objdir)configGeometry.pgo
configFurrows_pgo = $(objdir)configFurrows.pgo
configTimes_pgo = $(objdir)configTimes.pgo
configProbes_pgo = $(objdir)configProbes.pgo
configWindow_pgo = $(objdir)configWindow.pgo
graphics_pgo = $(objdir)graphics.pgo
mainWindow_pgo = $(objdir)mainWindow.pgo
surcos_gui_pgo = $(objdir)surcos_gui.pgo
main_pgo = $(objdir)main.pgo

objpgo = $(furrow_pgo) $(parameters_pgo) $(scheme_pgo) $(field_pgo) \
	$(kernel_pgo) $(configIrrigation_pgo) $(configGeometry_pgo) \
	$(configFurrows_pgo) $(configTimes_pgo) $(configProbes_pgo) \
	$(configWindow_pgo) $(graphics_pgo) $(mainWindow_pgo) @icon@ \
	$(surcos_gui_pgo)
objlibpgo = $(furrow_bin_pgo) $(parameters_bin_pgo) $(scheme_bin_pgo) \
	$(field_bin_pgo) $(kernel_bin_pgo) $(surcos_pgo)
objbinpgo = $(objlib) $(main_pgo)

furrow_o = $(objdir)furrow.o
paramaters_o = $(objdir)parameters.o
scheme_o = $(objdir)scheme.o
field_o = $(objdir)field.o
kernel_o = $(objdir)kernel.o
configIrrigation_o = $(objdir)configIrrigation.o
configGeometry_o = $(objdir)configGeometry.o
configFurrows_o = $(objdir)configFurrows.o
configTimes_o = $(objdir)configTimes.o
configProbes_o = $(objdir)configProbes.o
configWindow_o = $(objdir)configWindow.o
graphics_o = $(objdir)graphics.o
mainWindow_o = $(objdir)mainWindow.o
surcos_gui_o = $(objdir)surcos_gui.o
main_o = $(objdir)main.o

furrow_bin_o = $(objdir)furrow_bin.o
paramaters_bin_o = $(objdir)parameters_bin.o
scheme_bin_o = $(objdir)scheme_bin.o
field_bin_o = $(objdir)field_bin.o
kernel_bin_o = $(objdir)kernel_bin.o
surcos_bin_o = $(objdir)surcos.o

obj = $(furrow_o) $(parameters_o) $(scheme_o) $(field_o) $(kernel_o) \
	$(configIrrigation_o) $(configGeometry_o) $(configFurrows_o) \
	$(configTimes_o) $(configProbes_o) $(configWindow_o) $(graphics_o) \
	$(mainWindow_o) @icon@ $(surcos_gui_o)
objlib = $(furrow_bin_o) $(parameters_bin_o) $(scheme_bin_o) $(field_bin_o) \
	$(kernel_bin_o) $(surcos_o)
objbin = $(objlib) $(main_o)

man = $(mandir)ppal.tex $(mandir)bib/references.bib \
	$(mandir)chapters/Capitulo1.tex \
	$(mandir)chapters/Capitulo2.tex \
	$(mandir)chapters/Capitulo3.tex

man_en = $(mandir)ppal_EN.tex $(mandir)bib/references.bib \
	$(mandir)chapters/Chapter1.tex \
	$(mandir)chapters/Chapter2.tex \
	$(mandir)chapters/Chapter3.tex

png = logo3.png 

dll = $(dlldir)glew32.dll \
	$(dlldir)libatk-1.0-0.dll \
	$(dlldir)libbz2-1.dll \
	$(dlldir)libcairo-2.dll \
	$(dlldir)libcairo-gobject-2.dll \
	$(dlldir)libcroco-0.6-3.dll \
	$(dlldir)libepoxy-0.dll \
	$(dlldir)libexpat-1.dll \
	$(dlldir)libffi-6.dll \
	$(dlldir)libfontconfig-1.dll \
	$(dlldir)libfreeglut.dll \
	$(dlldir)libfreetype-6.dll \
	$(dlldir)@libgcc@.dll \
	$(dlldir)libgdk_pixbuf-2.0-0.dll \
	$(dlldir)libgdk-3-0.dll \
	$(dlldir)libgio-2.0-0.dll \
	$(dlldir)libglib-2.0-0.dll \
	$(dlldir)libgmodule-2.0-0.dll \
	$(dlldir)libgobject-2.0-0.dll \
	$(dlldir)libgraphite2.dll \
	$(dlldir)libgthread-2.0-0.dll \
	$(dlldir)libgtk-3-0.dll \
	$(dlldir)libharfbuzz-0.dll \
	$(dlldir)libiconv-2.dll \
	$(dlldir)libintl-8.dll \
	$(dlldir)liblzma-5.dll \
	$(dlldir)libpango-1.0-0.dll \
	$(dlldir)libpangocairo-1.0-0.dll \
	$(dlldir)libpangoft2-1.0-0.dll \
	$(dlldir)libpangowin32-1.0-0.dll \
	$(dlldir)libpcre-1.dll \
	$(dlldir)libpixman-1-0.dll \
	$(dlldir)libpng16-16.dll \
	$(dlldir)librsvg-2-2.dll \
	$(dlldir)libstdc++-6.dll \
	$(dlldir)libxml2-2.dll \
	$(dlldir)libwinpthread-1.dll \
	$(dlldir)zlib1.dll
gdkpixbuf = lib/gdk-pixbuf-2.0/2.10.0/
WINLIBS = atk bzip2 cairo expat fontconfig freeglut freetype gcc gdk-pixbuf2 \
	gettext glew glib2 graphite2 gtk3 harfbuzz libcroco libepoxy libffi \
	libiconv libpng librsvg libxml2 pango pcre pixman xz zlib

CPPFLAGS = @CPPFLAGS@ @PRECISION@ -DJBW=2
CFLAGSLIB = $(CPPFLAGS) -pedantic -Wall -Wextra -c -O3 @NATIVE@ \
	@GTHREAD_CFLAGS@ @GLIB_CFLAGS@ @GTOP_CFLAGS@ @PNG_CFLAGS@ @GTK_CFLAGS@ \
	@FREETYPE_CFLAGS@ @GLEW_CFLAGS@ @SDL_CFLAGS@ @GLFW_CFLAGS@ @GRAPHIC@ @FONT@
CFLAGS = $(CFLAGSLIB) -fPIC
JBFLAGSLIB = @LDFLAGS@ @LIBS@ @GTHREAD_LIBS@ @GLIB_LIBS@ @GTOP_LIBS@ \
	@PNG_LIBS@ @GTK_LIBS@ @FREETYPE_LIBS@ @GLEW_LIBS@ @SDL_LIBS@ @GLFW_LIBS@ \
	@GRAPHIC@
LDFLAGSLIB = $(JBFLAGSLIB) -L$(bindir) -Wl,@RPATH@$(bindir) -ljbw@SUFFIX@ \
	-ljbm@SUFFIX@ -ljb@SUFFIX@
LDFLAGS = $(LDFLAGSLIB) -lsurcos

CPPFLAGSBIN = @CPPFLAGS@ @PRECISION@ -DJBW=1
CFLAGSBINLIB = $(CPPFLAGSBIN) @GTHREAD_CFLAGS@ @GLIB_CFLAGS@ @GTOP_CFLAGS@ \
	-pedantic -Wall -Wextra -c -O3
CFLAGSBIN = $(CFLAGSBINLIB) -fPIC
JBFLAGSBINLIB = @LDFLAGS@ @LIBS@ @GTHREAD_LIBS@ @GLIB_LIBS@ @GTOP_LIBS@
LDFLAGSBINLIB = $(JBFLAGSBINLIB) -L$(bindir) -Wl,@RPATH@$(bindir) -ljbm@SUFFIX@ \
	-ljbbin@SUFFIX@
LDFLAGSBIN = $(LDFLAGSBINLIB) -lsurcos

CC = @CC@ @LTO@ @ccflags@ -g #-pg

ifeq (@PGO@, 1)
	pgogen = -fprofile-generate
	pgouse = -fprofile-use -fprofile-correction
	depexe = $(obj) $(exepgo)
	depexebin = $(objbin) $(exebinpgo)
	exepgo = $(bindir)@exegui@pgo
	exebinpgo = $(bindir)surcospgo
	exelibpgo = $(bindir)libsurcospgo@SO@
else
	dep = Makefile
	depkernel = $(dep) $(config_h) $(furrow_h) \
		$(parameters_h) $(scheme_h) $(field_h) $(srcdir)kernel.h
	depexe = $(obj)
	depexebin = $(objbin)
endif
depconfig = $(depkernel) $(configIrrigation_h) $(configGeometry_h) \
	$(configFurrows_h) $(configTimes_h) $(configProbes_h) $(configWindow_h)
depgui = $(depconfig) $(graphics_h) $(mainWindow_h)
depjb = $(srcdir)jb/jb_def.h $(srcdir)jb/jb_math.h $(srcdir)jb/jb_win.h
jb = $(bindir)libjbw@SUFFIX@.so $(bindir)libjbm@SUFFIX@.so $(bindir)libjb@SUFFIX@.so
jbbin = $(bindir)libjbm@SUFFIX@.so $(bindir)libjbbin@SUFFIX@.so
exe = $(bindir)@exegui@
exebin = $(bindir)surcos
exelib = $(bindir)libsurcos@SO@
manuals = doc/latex/refman.pdf $(mandir)ppal.pdf $(mandir)ppal_EN.pdf

all: $(exe) $(exebin) $(podir)surcos_gui.pot $(podir)surcos.pot \
	$(localdir)$(es)surcos_gui.mo $(localdir)$(es)surcos.mo \
	$(localdir)$(fr)surcos_gui.mo $(localdir)$(fr)surcos.mo \
	$(localdir)$(it)surcos_gui.mo $(localdir)$(it)surcos.mo

strip:
	@MAKE@
	strip $(exe) $(exebin) $(exelib)

manuals: $(manuals)

## Our main object (GUI)
$(exepgo): $(objpgo) $(jb) $(exelibpgo)
	$(CC) $(pgouse) $(objpgo) $(LDFLAGS) -o $(exepgo)
	$(exepgo) examples/furrow1
	$(exepgo) examples/furrows30x50
$(exe): $(obj) $(jb) $(exelib)
	$(CC) $(pgogen) $(obj) $(LDFLAGS) -o $(exe)

## Our main object (no GUI)
$(exepgobin): $(objpgobin) $(exelibpgo)
	$(CC) $(pgouse) $(objpgobin) $(LDFLAGSBIN) -o $(exepgobin)
	$(exepgobin) examples/furrow1
	$(exepgobin) examples/furrows30x50
$(exebin): $(objbin) $(exelib)
	$(CC) $(pgogen) $(objbin) $(LDFLAGSBIN) -o $(exebin)

## The SURCOS library
$(exelibpgo): $(objlibpgo) $(jbbin)
	$(CC) $(pgouse) -shared $(objlibpgo) $(LDFLAGSBINLIB) -o $(exelibpgo)
$(exelib): $(objlib) $(jbbin)
	$(CC) $(pgogen) -shared $(objlib) $(LDFLAGSBINLIB) -o $(exelib)

$(furrow_o): $(depjb) $(config_h) $(furrow_h) $(furrow_c)
	$(CC) $(CFLAGS) $(furrow_c) -o $(furrow_o)

$(furrow_bin_o): $(depjb) $(config_h) $(furrow_h) $(furrow_c)
	$(CC) $(CFLAGSBIN) $(furrow_c) -o $(furrow_bin_o)

$(parameters_o): $(depjb) $(config_h) $(furrow_h) $(parameters_h) \
	$(parameters_c)
	$(CC) $(CFLAGS) $(parameters_c) -o $(parameters_o)

$(parameters_bin_o): $(depjb) $(config_h) $(furrow_h) $(parameters_h) \
	$(parameters_c)
	$(CC) $(CFLAGSBIN) $(parameters_c) -o $(parameters_bin_o)

$(scheme_o): $(depjb) $(config_h) $(furrow_h) $(parameters_h) $(scheme_h) \
	$(scheme_c)
	$(CC) $(CFLAGS) $(scheme_c) -o $(scheme_o)

$(scheme_bin_o): $(depjb) $(config_h) $(furrow_h) $(parameters_h) $(scheme_h) \
	$(scheme_c)
	$(CC) $(CFLAGSBIN) $(scheme_c) -o $(scheme_bin_o)

$(field_o): $(depjb) $(config_h) $(furrow_h) $(parameters_h) $(scheme_h) \
	$(field_h) $(field_c)
	$(CC) $(CFLAGS) $(field_c) -o $(field_o)

$(field_bin_o): $(depjb) $(config_h) $(furrow_h) $(parameters_h) $(scheme_h) \
	$(field_h) $(field_c)
	$(CC) $(CFLAGSBIN) $(field_c) -o $(field_bin_o)

$(kernel_o): $(depkernel) $(graphics_h) $(mainWindow_h) $(kernel_c)
	$(CC) $(CFLAGS) $(kernel_c) -o $(kernel_o)

$(kernel_bin_o): $(depkernel) $(kernel_c)
	$(CC) $(CFLAGSBIN) $(kernel_c) -o $(kernel_bin_o)

$(configIrrigation_o): $(depkernel) $(configIrrigation_h) $(configIrrigation_c)
	$(CC) $(CFLAGS) $(configIrrigation_c) -o $(configIrrigation_o)

$(configGeometry_o): $(depkernel) $(configGeometry_h) $(configGeometry_c)
	$(CC) $(CFLAGS) $(configGeometry_c) -o $(configGeometry_o)

$(configFurrows_o): $(depkernel) $(configFurrows_h) $(configFurrows_c)
	$(CC) $(CFLAGS) $(configFurrows_c) -o $(configFurrows_o)

$(configTimes_o): $(depkernel) $(configTimes_h) $(configTimes_c)
	$(CC) $(CFLAGS) $(configTimes_c) -o $(configTimes_o)

$(configProbes_o): $(depkernel) $(configProbes_h) $(configProbes_c)
	$(CC) $(CFLAGS) $(configProbes_c) -o $(configProbes_o)

$(configWindow_o): $(depgui) $(configWindow_c)
	$(CC) $(CFLAGS) $(configWindow_c) -o $(configWindow_o)

$(graphics_o): $(depgui) $(graphics_c)
	$(CC) $(CFLAGS) $(graphics_c) -o $(graphics_o)

$(mainWindow_o): $(depgui) $(mainWindow_c)
	$(CC) $(CFLAGS) $(mainWindow_c) -o $(mainWindow_o)

$(surcos_gui_o): $(depgui) $(surcos_gui_c)
	$(CC) $(CFLAGS) $(surcos_gui_c) -o $(surcos_gui_o)

$(surcos_o): $(dep) $(surcos_c)
	$(CC) $(CFLAGSBIN) $(surcos_c) -o $(surcos_o)

$(main_o): $(dep) $(surcos_h) $(main_c)
	$(CC) $(CFLAGSLIB) $(main_c) -o $(main_o)

## Making the icon on Microsoft Windows
$(objdir)logo.o: logo.rc logo2.ico
	@WINDRES@ logo.rc -o $(objdir)logo.o

## Making the languages general rules (GUI)
$(podir)surcos_gui.pot: Makefile $(src) 
	xgettext -k_ -d $(exe) -o $(podir)surcos_gui.pot --from-code=UTF-8 $(src)
## THE FIRST TIME
#	msginit -l es -o $(podir)$(es)surcos_gui.po -i $(podir)surcos_gui.pot \
#		--no-translator
#	msginit -l fr -o $(podir)$(fr)surcos_gui.po -i $(podir)surcos_gui.pot \
#		--no-translator
## OTHER TIMES
	msgmerge -U $(podir)$(es)surcos_gui.po $(podir)surcos_gui.pot
	msgmerge -U $(podir)$(fr)surcos_gui.po $(podir)surcos_gui.pot
	msgmerge -U $(podir)$(it)surcos_gui.po $(podir)surcos_gui.pot
	vim -p $(podir)$(es)surcos_gui.po $(podir)$(fr)surcos_gui.po \
		$(podir)$(it)surcos_gui.po

## Making the languages general rules (no GUI)
$(podir)surcos.pot: Makefile $(srcbin)
	xgettext -k_ -d $(exebin) -o $(podir)surcos.pot --from-code=UTF-8 $(srcbin)
## THE FIRST TIME
#	msginit -l es -o $(podir)$(es)surcos.po -i $(podir)surcos.pot \
#		--no-translator
#	msginit -l fr -o $(podir)$(fr)surcos.po -i $(podir)surcos.pot \
#		--no-translator
## OTHER TIMES
	msgmerge -U $(podir)$(es)surcos.po $(podir)surcos.pot
	msgmerge -U $(podir)$(fr)surcos.po $(podir)surcos.pot
	msgmerge -U $(podir)$(it)surcos.po $(podir)surcos.pot
	vim -p $(podir)$(es)surcos.po $(podir)$(fr)surcos.po \
		$(podir)$(it)surcos.po

## Compiling the spanish language
$(localdir)$(es)surcos_gui.mo: $(podir)$(es)surcos_gui.po $(podir)surcos_gui.pot
	test -d $(localdir)$(es) || mkdir -p $(localdir)$(es)
	msgfmt -c -v -o $(localdir)$(es)surcos_gui.mo $(podir)$(es)surcos_gui.po

$(localdir)$(es)surcos.mo: $(podir)$(es)surcos.po $(podir)surcos.pot
	msgfmt -c -v -o $(localdir)$(es)surcos.mo $(podir)$(es)surcos.po

## Compiling the french language
$(localdir)$(fr)surcos_gui.mo: $(podir)$(fr)surcos_gui.po $(podir)surcos_gui.pot
	test -d $(localdir)$(fr) || mkdir -p $(localdir)$(fr)
	msgfmt -c -v -o $(localdir)$(fr)surcos_gui.mo $(podir)$(fr)surcos_gui.po

$(localdir)$(fr)surcos.mo: $(podir)$(fr)surcos.po $(podir)surcos.pot
	msgfmt -c -v -o $(localdir)$(fr)surcos.mo $(podir)$(fr)surcos.po

## Compiling the italian language
$(localdir)$(it)surcos_gui.mo: $(podir)$(it)surcos_gui.po $(podir)surcos_gui.pot
	test -d $(localdir)$(it) || mkdir -p $(localdir)$(it)
	msgfmt -c -v -o $(localdir)$(it)surcos_gui.mo $(podir)$(it)surcos_gui.po

$(localdir)$(it)surcos.mo: $(podir)$(it)surcos.po $(podir)surcos.pot
	msgfmt -c -v -o $(localdir)$(it)surcos.mo $(podir)$(it)surcos.po

## Making the reference manual
doc/latex/Makefile: Doxyfile Makefile $(depgui) $(src) $(surcos_c)
	doxygen

doc/latex/refman.pdf: doc/latex/Makefile
	cd doc/latex; make

## Compiling the user manuals
$(mandir)ppal.pdf: Makefile $(man)
	cd $(mandir); @latex@ ppal; @latex@ ppal

$(mandir)ppal_EN.pdf: Makefile $(man_en)
	cd $(mandir); @latex@ ppal_EN; @latex@ ppal_EN

## Clean all generated-objects
clean:
	rm configure Makefile $(exe) $(exebin) $(objdir)*.o \
		$(mandir)ppal.pdf $(mandir)ppal_EN.pdf \
		$(localdir)$(es)surcos*.mo $(localdir)$(fr)surcos*.mo
		$(localdir)$(it)surcos*.mo

## Rebuild option with cleaning functionallity
rebuild: clean $(exe)

## Making Microsoft Windows distribution
dist: $(exe) $(exebin) $(dll) $(manuals) \
	$(localdir)$(es)surcos_gui.mo $(localdir)$(es)surcos.mo \
	$(localdir)$(fr)surcos_gui.mo $(localdir)$(fr)surcos.mo \
	$(localdir)$(it)surcos_gui.mo $(localdir)$(it)surcos.mo
	test -d $(icondir) || mkdir -p $(icondir)
	cp $(dll) $(png) $(bindir)
	test -d $(sharedir)glib-2.0/schemas || mkdir -p $(sharedir)glib-2.0/schemas
	cp $(sysdir)share/glib-2.0/schemas/* $(sharedir)glib-2.0/schemas
	cp -r $(sysdir)share/icons/Adwaita $(icondir)
	cp -r $(sysdir)share/icons/hicolor $(icondir)
	test -d @WIN@$(gdkpixbuf)loaders || mkdir -p @WIN@$(gdkpixbuf)loaders
	cp $(sysdir)$(gdkpixbuf)loaders.cache @WIN@$(gdkpixbuf)
	cp $(sysdir)$(gdkpixbuf)loaders/*.dll @WIN@$(gdkpixbuf)loaders
	strip $(bindir)*.exe $(bindir)*.dll @WIN@$(gdkpixbuf)loaders/*.dll
	cp doc/latex/refman.pdf $(basedir)reference-manual.pdf
	cp manual/ppal.pdf $(basedir)user-manual-es.pdf
	cp manual/ppal_EN.pdf $(basedir)user-manual-en.pdf
	cp --parents examples/*/*.in @basedir@
	cp $(modir)$(es)atk10.mo $(modir)$(es)gdk-pixbuf.mo \
		$(modir)$(es)gettext-runtime.mo $(modir)$(es)glib20.mo \
		$(modir)$(es)gtk30.mo $(modir)$(es)gtk30-properties.mo \
		$(localdir)$(es)
	cp $(modir)$(fr)atk10.mo $(modir)$(fr)gdk-pixbuf.mo \
		$(modir)$(fr)gettext-runtime.mo $(modir)$(fr)glib20.mo \
		$(modir)$(fr)gtk30.mo $(modir)$(fr)gtk30-properties.mo \
		$(localdir)$(fr)
	cp $(modir)$(it)atk10.mo $(modir)$(it)gdk-pixbuf.mo \
		$(modir)$(it)gettext-runtime.mo $(modir)$(it)glib20.mo \
		$(modir)$(it)gtk30.mo $(modir)$(it)gtk30-properties.mo \
		$(localdir)$(it)
	test -d @WIN@src || mkdir @WIN@src
	cd @WIN@src; perl ../../fetch.pl $(WINLIBS)
